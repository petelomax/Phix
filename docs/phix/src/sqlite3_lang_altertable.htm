<head>
 <body>
  <toc>
   <these>
    <get>
     <stripped>
      <h1 class="title">ALTER TABLE</h1>
      <div id="mainSection">
       <script>
function hideorshow(btn,obj){
var x = document.getElementById(obj);
var b = document.getElementById(btn);
    if( x.style.display!='none' ){
        x.style.display = 'none';
        b.innerHTML='show';
    }else{
        x.style.display = '';
        b.innerHTML='hide';
    }
    return false;
}
       </script>
       <p>
        <b>
         <a href="sqlite3_syntaxdiagrams.htm#alter-table-stmt">alter-table-stmt:</a>
        </b>
        <button id='x743' onclick='hideorshow("x743","x744")'>hide</button>
       </p>
       <div id='x744' class='imgcontainer'>
        <img alt="syntax diagram alter-table-stmt" src="images/syntax/alter-table-stmt.gif" />
        <p>
         <b>
          <a href="sqlite3_syntaxdiagrams.htm#column-def">column-def:</a>
         </b>
         <button id='x745' onclick='hideorshow("x745","x746")'>show</button>
        </p>
        <div id='x746' style='display:none;' class='imgcontainer'>
         <img alt="syntax diagram column-def" src="images/syntax/column-def.gif" />
         <p>
          <b>
           <a href="sqlite3_syntaxdiagrams.htm#column-constraint">column-constraint:</a>
          </b>
          <button id='x747' onclick='hideorshow("x747","x748")'>show</button>
         </p>
         <div id='x748' style='display:none;' class='imgcontainer'>
          <img alt="syntax diagram column-constraint" src="images/syntax/column-constraint.gif" />
          <p>
           <b>
            <a href="sqlite3_syntaxdiagrams.htm#conflict-clause">conflict-clause:</a>
           </b>
           <button id='x749' onclick='hideorshow("x749","x750")'>show</button>
          </p>
          <div id='x750' style='display:none;' class='imgcontainer'>
           <img alt="syntax diagram conflict-clause" src="images/syntax/conflict-clause.gif" />
          </div>
          <p>
           <b>
            <a href="sqlite3_syntaxdiagrams.htm#expr">expr:</a>
           </b>
           <button id='x751' onclick='hideorshow("x751","x752")'>show</button>
          </p>
          <div id='x752' style='display:none;' class='imgcontainer'>
           <img alt="syntax diagram expr" src="images/syntax/expr.gif" />
           <p>
            <b>
             <a href="sqlite3_syntaxdiagrams.htm#raise-function">raise-function:</a>
            </b>
            <button id='x753' onclick='hideorshow("x753","x754")'>show</button>
           </p>
           <div id='x754' style='display:none;' class='imgcontainer'>
            <img alt="syntax diagram raise-function" src="images/syntax/raise-function.gif" />
           </div>
           <p>
            <b>
             <a href="sqlite3_syntaxdiagrams.htm#select-stmt">select-stmt:</a>
            </b>
            <button id='x755' onclick='hideorshow("x755","x756")'>show</button>
           </p>
           <div id='x756' style='display:none;' class='imgcontainer'>
            <img alt="syntax diagram select-stmt" src="images/syntax/select-stmt.gif" />
            <p>
             <b>
              <a href="sqlite3_syntaxdiagrams.htm#common-table-expression">common-table-expression:</a>
             </b>
             <button id='x757' onclick='hideorshow("x757","x758")'>show</button>
            </p>
            <div id='x758' style='display:none;' class='imgcontainer'>
             <img alt="syntax diagram common-table-expression" src="images/syntax/common-table-expression.gif" />
            </div>
            <p>
             <b>
              <a href="sqlite3_syntaxdiagrams.htm#compound-operator">compound-operator:</a>
             </b>
             <button id='x759' onclick='hideorshow("x759","x760")'>show</button>
            </p>
            <div id='x760' style='display:none;' class='imgcontainer'>
             <img alt="syntax diagram compound-operator" src="images/syntax/compound-operator.gif" />
            </div>
            <p>
             <b>
              <a href="sqlite3_syntaxdiagrams.htm#join-clause">join-clause:</a>
             </b>
             <button id='x761' onclick='hideorshow("x761","x762")'>show</button>
            </p>
            <div id='x762' style='display:none;' class='imgcontainer'>
             <img alt="syntax diagram join-clause" src="images/syntax/join-clause.gif" />
             <p>
              <b>
               <a href="sqlite3_syntaxdiagrams.htm#join-constraint">join-constraint:</a>
              </b>
              <button id='x763' onclick='hideorshow("x763","x764")'>show</button>
             </p>
             <div id='x764' style='display:none;' class='imgcontainer'>
              <img alt="syntax diagram join-constraint" src="images/syntax/join-constraint.gif" />
             </div>
             <p>
              <b>
               <a href="sqlite3_syntaxdiagrams.htm#join-operator">join-operator:</a>
              </b>
              <button id='x765' onclick='hideorshow("x765","x766")'>show</button>
             </p>
             <div id='x766' style='display:none;' class='imgcontainer'>
              <img alt="syntax diagram join-operator" src="images/syntax/join-operator.gif" />
             </div>
            </div>
            <p>
             <b>
              <a href="sqlite3_syntaxdiagrams.htm#ordering-term">ordering-term:</a>
             </b>
             <button id='x767' onclick='hideorshow("x767","x768")'>show</button>
            </p>
            <div id='x768' style='display:none;' class='imgcontainer'>
             <img alt="syntax diagram ordering-term" src="images/syntax/ordering-term.gif" />
            </div>
            <p>
             <b>
              <a href="sqlite3_syntaxdiagrams.htm#result-column">result-column:</a>
             </b>
             <button id='x769' onclick='hideorshow("x769","x770")'>show</button>
            </p>
            <div id='x770' style='display:none;' class='imgcontainer'>
             <img alt="syntax diagram result-column" src="images/syntax/result-column.gif" />
            </div>
            <p>
             <b>
              <a href="sqlite3_syntaxdiagrams.htm#table-or-subquery">table-or-subquery:</a>
             </b>
             <button id='x771' onclick='hideorshow("x771","x772")'>show</button>
            </p>
            <div id='x772' style='display:none;' class='imgcontainer'>
             <img alt="syntax diagram table-or-subquery" src="images/syntax/table-or-subquery.gif" />
            </div>
           </div>
          </div>
          <p>
           <b>
            <a href="sqlite3_syntaxdiagrams.htm#foreign-key-clause">foreign-key-clause:</a>
           </b>
           <button id='x773' onclick='hideorshow("x773","x774")'>show</button>
          </p>
          <div id='x774' style='display:none;' class='imgcontainer'>
           <img alt="syntax diagram foreign-key-clause" src="images/syntax/foreign-key-clause.gif" />
          </div>
          <p>
           <b>
            <a href="sqlite3_syntaxdiagrams.htm#literal-value">literal-value:</a>
           </b>
           <button id='x775' onclick='hideorshow("x775","x776")'>show</button>
          </p>
          <div id='x776' style='display:none;' class='imgcontainer'>
           <img alt="syntax diagram literal-value" src="images/syntax/literal-value.gif" />
          </div>
          <p>
           <b>
            <a href="sqlite3_syntaxdiagrams.htm#signed-number">signed-number:</a>
           </b>
           <button id='x777' onclick='hideorshow("x777","x778")'>show</button>
          </p>
          <div id='x778' style='display:none;' class='imgcontainer'>
           <img alt="syntax diagram signed-number" src="images/syntax/signed-number.gif" />
          </div>
         </div>
         <p>
          <b>
           <a href="sqlite3_syntaxdiagrams.htm#type-name">type-name:</a>
          </b>
          <button id='x779' onclick='hideorshow("x779","x780")'>show</button>
         </p>
         <div id='x780' style='display:none;' class='imgcontainer'>
          <img alt="syntax diagram type-name" src="images/syntax/type-name.gif" />
          <p>
           <b>
            <a href="sqlite3_syntaxdiagrams.htm#signed-number">signed-number:</a>
           </b>
           <button id='x781' onclick='hideorshow("x781","x782")'>show</button>
          </p>
          <div id='x782' style='display:none;' class='imgcontainer'>
           <img alt="syntax diagram signed-number" src="images/syntax/signed-number.gif" />
          </div>
         </div>
        </div>
       </div>
       <p>
        SQLite supports a limited subset of ALTER TABLE.
        The ALTER TABLE command in SQLite allows the user to rename a table
        or to add a new column to an existing table.
       </p>
       <p>
        The RENAME TO syntax changes the name of
        <span class='yyterm'>table-name</span>
        to
        <span class='yyterm'>new-table-name</span>.
        This command cannot be used to move a table between attached databases, only to rename 
        a table within the same database.
       </p>
       <p>
        If the table being renamed has triggers or indices, then these remain
        attached to the table after it has been renamed.  However, if there are
        any view definitions, or statements executed by triggers that refer to
        the table being renamed, these are not automatically modified to use the new
        table name. If this is required, the triggers or view definitions must be
        dropped and recreated to use the new table name by hand.
       </p>
       <blockquote>
        <table border="1" cellpadding="10">
         <tr>
          <td>
            <em>Important Note:</em>
            The 'ALTER TABLE ... RENAME TO ...' command does not update action
            statements within triggers or SELECT statements within views.
            If the table being renamed is referenced from within triggers or views,
            then those triggers and views must be dropped and recreated separately
            by the application.
          </td>
         </tr>
        </table>
       </blockquote>
        <p></p>
        <br>
        &nbsp;
        <br>
        &nbsp;
        <br>
       <p>
        If <a href="sqlite3_foreignkeys.htm">foreign key constraints</a> are
        <a href="sqlite3_pragma.htm#pragma_foreign_keys">enabled</a> when a table is renamed, then any
        <a href="sqlite3_syntaxdiagrams.htm#foreign-key-clause">REFERENCES clauses</a> in any table (either the
        table being renamed or some other table)
        that refer to the table being renamed are modified to refer 
        to the renamed table by its new name.
       </p>
       <p>
        The ADD COLUMN syntax is used to add a new column to an existing table.
        The new column is always appended to the end of the list of existing columns.
        The <a href="sqlite3_syntaxdiagrams.htm#column-def">column-def</a> rule defines the characteristics of the new column.
        The new column may take any of the forms permissible in a
        <a href="sqlite3_lang_createtable.htm">CREATE TABLE</a>
        statement, with the following restrictions:
       </p>
       <ul>
        <li>The column may not have a PRIMARY KEY or UNIQUE constraint.</li>
        <li>The column may not have a default value of CURRENT_TIME, CURRENT_DATE, 
            CURRENT_TIMESTAMP, or an expression in parentheses.
        </li>
        <li>If a NOT NULL constraint is specified, then the column must have a
            default value other than NULL.
        </li>
        <li>If
         <a href="sqlite3_foreignkeys.htm">foreign key constraints</a> are
         <a href="sqlite3_pragma.htm#pragma_foreign_keys">enabled</a> and
            a column with a
         <a href="sqlite3_syntaxdiagrams.htm#foreign-key-clause">REFERENCES clause</a>
            is added, the column must have a default value of NULL.
        </li>
       </ul>
       <p>Note also that when adding a
        <a href="sqlite3_lang_createtable.htm#ckconst">CHECK constraint</a>, the CHECK constraint
        is not tested against preexisting rows of the table.
        This can result in a table that contains data that
        is in violation of the CHECK constraint.  Future versions of SQLite might
        change to validate CHECK constraints as they are added.
       </p>
       <p>
        The execution time of the ALTER TABLE command is independent of
        the amount of data in the table.  The ALTER TABLE command runs as quickly
        on a table with 10 million rows as it does on a table with 1 row.
       </p>
       <p>
        After ADD COLUMN has been run on a database, that database will not
        be readable by SQLite version 3.1.3 (2005-02-20) and earlier.
       </p>
       <a name="otheralter"></a>
       <h3>Making Other Kinds Of Table Schema Changes</h3>
       <p>
        The only schema altering commands directly supported by SQLite are the
        "rename table" and "add column" commands shown above.  However, applications
        can make other arbitrary changes to the format of a table using a simple
        sequence of operations.
        The steps to make arbitrary changes to the schema design of some table X
        are as follows:
       </p>
       <ol>
        <li>
         <p>
            If foreign key constraints are enabled, disable them using
          <a href="sqlite3_pragma.htm#pragma_foreign_keys">PRAGMA foreign_keys=OFF</a>.
         </p>
        </li>
        <li>
         <p>Start a transaction.</p>
        </li>
        <li>
         <p>
            Remember the format of all indexes and triggers associated with table X.
            This information will be needed in step 8 below.  One way to do this is
            to run a query like the following:
            SELECT type, sql FROM sqlite_master WHERE tbl_name='X'.
         </p>
        </li>
        <li>
         <p>
            Use
          <a href="sqlite3_lang_createtable.htm">CREATE TABLE</a> to construct a new table "new_X" that is in the desired
            revised format of table X.  Make sure that the name "new_X" does not collide
            with any existing table name, of course.
         </p>
        </li>
        <li>
         <p>
            Transfer content from X into new_X using a statement
            like: INSERT INTO new_X SELECT ... FROM X.
         </p>
        </li>
        <li>
         <p>
            Drop the old table X:
          <a href="sqlite3_lang_droptable.htm">DROP TABLE X</a>.
         </p>
        </li>
        <li>
         <p>Change the name of new_X to X using: ALTER TABLE new_X RENAME TO X.</p>
        </li>
        <li>
         <p>
            Use
          <a href="sqlite3_lang_createindex.htm">CREATE INDEX</a> and
          <a href="sqlite3_lang_createtrigger.htm">CREATE TRIGGER</a> to reconstruct indexes and triggers
            associated with table X.  Perhaps use the old format of the triggers and
            indexes saved from step 3 above as a guide, making changes as appropriate
            for the alteration.
         </p>
        </li>
        <li>
         <p>If any views refer to table X in a way that is affected by the
                            schema change, then drop those views using
          <a href="sqlite3_lang_dropview.htm">DROP VIEW</a> and recreate them
            with whatever changes are necessary to accommodate the schema change
            using
          <a href="sqlite3_lang_createview.htm">CREATE VIEW</a>.
         </p>
        </li>
        <li>
         <p>If foreign key constraints were originally enabled then run
          <a href="sqlite3_pragma.htm#pragma_foreign_key_check">PRAGMA foreign_key_check</a> to verify that the schema
            change did not break any foreign key constraints.
         </p>
        </li>
        <li>
         <p>Commit the transaction started in step 2.</p>
        </li>
        <li>
         <p>If foreign keys constraints were originally enabled, reenable them now.</p>
        </li>
       </ol>
       <p>
        The procedure above is completely general and will work even if the
        schema change causes the information stored in the table to change.
        So the full procedure above is appropriate for dropping a column,
        changing the order of columns, adding or removing a UNIQUE constraint
        or PRIMARY KEY, adding CHECK or FOREIGN KEY or NOT NULL constraints,
        or changing the datatype for a column, for example.  However, a simpler
        and faster procedure can optionally be used for
        some changes that do no affect the on-disk content in any way.
        The following simpler procedure is appropriate for removing
        CHECK or FOREIGN KEY or NOT NULL constraints,
        renaming columns, or adding or removing or changing default values on
        a column.
       </p>
       <ol>
        <li>
         <p> Start a transaction.</p>
        </li>
        <li>
         <p> Run
          <a href="sqlite3_pragma.htm#pragma_schema_version">PRAGMA schema_version</a> to determine the current schema
            version number.  This number will be needed for step 6 below.
         </p>
        </li>
        <li>
         <p> Activate schema editing using
          <a href="sqlite3_pragma.htm#pragma_writable_schema">PRAGMA writable_schema=ON</a>.
         </p>
        </li>
        <li>
         <p> Run an
          <a href="sqlite3_lang_update.htm">UPDATE</a> statement to change the definition of table X
            in the sqlite_master table: 
            UPDATE sqlite_master SET sql=... WHERE type='table' AND name='X';
         </p>
         <p>
            <em>Caution:</em>
            Making a change to the sqlite_master table like this will
            render the database corrupt and unreadable if the change contains
            a syntax error.  It is suggested that careful testing of the UPDATE
            statement be done on a separate blank database prior to using it on
            a database containing important data.
         </p>
        </li>
        <li>
         <p>
            If the change to table X also affects other tables or indexes or
            triggers are views within schema, then run
          <a href="sqlite3_lang_update.htm">UPDATE</a> statements to modify
            those other tables indexes and views too.  For example, if the name of
            a column changes, all FOREIGN KEY constraints, triggers, indexes, and
            views that refer to that column must be modified.
         </p>
         <p>
            <em>Caution:</em>
            Once again, making changes to the sqlite_master 
            table like this will render the database corrupt and unreadable if the 
            change contains an error.  Carefully test of this entire procedure
            on a separate test database prior to using it on
            a database containing important data and/or make backup copies of
            important databases prior to running this procedure.
         </p>
        </li>
        <li>
         <p>
            Increment the schema version number using
          <a href="sqlite3_pragma.htm#pragma_schema_version">PRAGMA schema_version=X</a> where X is one
            more than the old schema version number found in step 2 above.
         </p>
        </li>
        <li>
         <p> Disable schema editing using
          <a href="sqlite3_pragma.htm#pragma_writable_schema">PRAGMA writable_schema=OFF</a>.
         </p>
        </li>
        <li>
         <p> (Optional) Run
          <a href="sqlite3_pragma.htm#pragma_integrity_check">PRAGMA integrity_check</a> to verify that the
                schema changes did not damage the database.
         </p>
        </li>
        <li>
         <p> Commit the transaction started on step 1 above.</p>
        </li>
       </ol>
       <p>If some future version of SQLite adds new ALTER TABLE capabilities, 
            those capabilities will very likely use one of the two procedures
            outlined above.
       </p>
      </div>
     </stripped>
    </get>
   </these>
  </toc>
 </body>
</head>
